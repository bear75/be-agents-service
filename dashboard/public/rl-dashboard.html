<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>RL Learning Dashboard - Agent Service</title>
  <link rel="stylesheet" href="style.css">
  <style>
    .rl-container {
      max-width: 1800px;
      margin: 0 auto;
      padding: 20px;
    }

    .nav-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
      padding: 20px 30px;
      background: var(--glass-white);
      backdrop-filter: blur(var(--glass-blur)) saturate(180%);
      border: 2px solid var(--glass-border);
      border-radius: var(--border-radius-lg);
      box-shadow: var(--shadow-lg);
    }

    .nav-header h1 {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      font-weight: 800;
    }

    .nav-links {
      display: flex;
      gap: 10px;
    }

    .nav-link {
      padding: 10px 20px;
      background: rgba(102, 126, 234, 0.1);
      border: 2px solid rgba(102, 126, 234, 0.2);
      border-radius: 8px;
      color: var(--text-primary);
      text-decoration: none;
      font-weight: 600;
      transition: all 0.2s;
    }

    .nav-link:hover {
      background: rgba(102, 126, 234, 0.2);
      transform: translateY(-2px);
    }

    .nav-link.active {
      background: #667eea;
      color: white;
      border-color: #667eea;
    }

    .dashboard-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
      gap: 20px;
      margin-bottom: 30px;
    }

    .stat-card {
      background: var(--glass-light);
      backdrop-filter: blur(15px);
      border: 2px solid var(--glass-border);
      border-radius: var(--border-radius);
      padding: 20px;
      box-shadow: var(--shadow-md);
      transition: all 0.3s;
    }

    .stat-card:hover {
      transform: translateY(-4px);
      box-shadow: var(--shadow-lg);
    }

    .stat-label {
      color: var(--text-secondary);
      font-size: 13px;
      font-weight: 600;
      margin-bottom: 8px;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .stat-value {
      font-size: 36px;
      font-weight: 800;
      margin-bottom: 10px;
    }

    .stat-subtitle {
      color: var(--text-muted);
      font-size: 12px;
      font-weight: 500;
    }

    .section-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin: 30px 0 15px;
    }

    .section-title {
      font-size: 24px;
      font-weight: 700;
      color: var(--text-primary);
    }

    .card {
      background: var(--glass-light);
      backdrop-filter: blur(15px);
      border: 2px solid var(--glass-border);
      border-radius: var(--border-radius);
      padding: 20px;
      margin-bottom: 15px;
      box-shadow: var(--shadow-sm);
      transition: all 0.2s;
    }

    .card:hover {
      box-shadow: var(--shadow-md);
    }

    .experiment-card {
      border-left: 4px solid transparent;
    }

    .experiment-card.active {
      border-left-color: #667eea;
    }

    .experiment-card.successful {
      border-left-color: #48bb78;
    }

    .experiment-card.killed {
      border-left-color: #f56565;
    }

    .card-header {
      display: flex;
      justify-content: space-between;
      align-items: start;
      margin-bottom: 15px;
    }

    .card-title {
      font-size: 16px;
      font-weight: 700;
      color: var(--text-primary);
    }

    .card-subtitle {
      font-size: 13px;
      color: var(--text-secondary);
      margin-top: 4px;
    }

    .badge {
      padding: 4px 12px;
      border-radius: 12px;
      font-size: 11px;
      font-weight: 700;
      text-transform: uppercase;
    }

    .badge.active { background: rgba(102, 126, 234, 0.2); color: #667eea; }
    .badge.successful { background: rgba(72, 187, 120, 0.2); color: #48bb78; }
    .badge.killed { background: rgba(245, 101, 101, 0.2); color: #f56565; }
    .badge.keep { background: rgba(237, 137, 54, 0.2); color: #ed8936; }
    .badge.double-down { background: rgba(72, 187, 120, 0.2); color: #48bb78; }

    .metric-row {
      display: flex;
      justify-content: space-between;
      padding: 8px 0;
      border-bottom: 1px solid rgba(0,0,0,0.05);
    }

    .metric-row:last-child {
      border-bottom: none;
    }

    .metric-label {
      color: var(--text-secondary);
      font-size: 13px;
      font-weight: 600;
    }

    .metric-value {
      color: var(--text-primary);
      font-size: 14px;
      font-weight: 700;
    }

    .action-buttons {
      display: flex;
      gap: 10px;
      margin-top: 15px;
    }

    .btn {
      padding: 8px 16px;
      border: none;
      border-radius: 6px;
      font-size: 13px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s;
    }

    .btn:hover {
      transform: translateY(-2px);
      box-shadow: var(--shadow-md);
    }

    .btn-primary {
      background: #667eea;
      color: white;
    }

    .btn-success {
      background: #48bb78;
      color: white;
    }

    .btn-danger {
      background: #f56565;
      color: white;
    }

    .btn-secondary {
      background: rgba(102, 126, 234, 0.1);
      color: #667eea;
      border: 2px solid rgba(102, 126, 234, 0.2);
    }

    .pattern-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
      gap: 15px;
    }

    .pattern-card {
      background: white;
      border: 2px solid rgba(102, 126, 234, 0.1);
      border-radius: 10px;
      padding: 15px;
      transition: all 0.2s;
    }

    .pattern-card:hover {
      border-color: rgba(102, 126, 234, 0.3);
      box-shadow: var(--shadow-md);
    }

    .pattern-card.success {
      border-left: 4px solid #48bb78;
    }

    .pattern-card.failure {
      border-left: 4px solid #f56565;
    }

    .pattern-card.repetition {
      border-left: 4px solid #ed8936;
    }

    .agent-performance-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
      gap: 15px;
    }

    .agent-card {
      background: linear-gradient(135deg, rgba(102, 126, 234, 0.05) 0%, rgba(118, 75, 162, 0.05) 100%);
      border: 2px solid rgba(102, 126, 234, 0.15);
      border-radius: 10px;
      padding: 15px;
      text-align: center;
    }

    .agent-emoji {
      font-size: 40px;
      margin-bottom: 10px;
    }

    .agent-name {
      font-size: 16px;
      font-weight: 700;
      color: var(--text-primary);
      margin-bottom: 5px;
    }

    .agent-stats {
      margin-top: 10px;
      padding-top: 10px;
      border-top: 1px solid rgba(0,0,0,0.1);
    }

    .cost-table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 15px;
    }

    .cost-table th {
      text-align: left;
      padding: 10px;
      background: rgba(102, 126, 234, 0.1);
      font-size: 12px;
      font-weight: 700;
      text-transform: uppercase;
      color: var(--text-secondary);
    }

    .cost-table td {
      padding: 10px;
      border-bottom: 1px solid rgba(0,0,0,0.05);
      font-size: 13px;
    }

    .cost-table tr:hover {
      background: rgba(102, 126, 234, 0.05);
    }

    .loading {
      text-align: center;
      padding: 40px;
      color: var(--text-muted);
      font-style: italic;
    }

    .empty-state {
      text-align: center;
      padding: 60px 20px;
      color: var(--text-muted);
    }

    .empty-state h3 {
      font-size: 20px;
      margin-bottom: 10px;
    }

    .chart-container {
      height: 300px;
      padding: 20px;
      background: white;
      border-radius: 10px;
      margin-top: 15px;
    }
  </style>
</head>
<body>
  <div class="rl-container">
    <!-- Navigation Header -->
    <div class="nav-header">
      <h1 style="margin: 0;">üß† RL Learning Dashboard</h1>
      <div class="nav-links">
        <a href="/management-team.html" class="nav-link">Management</a>
        <a href="/engineering.html" class="nav-link">Engineering</a>
        <a href="/sales-marketing.html" class="nav-link">Sales & Marketing</a>
        <a href="/rl-dashboard.html" class="nav-link active">RL Dashboard</a>
        <a href="/kanban.html" class="nav-link">üìã Task Board</a>
        <a href="/commands.html" class="nav-link">Docs & Commands</a>
        <a href="/settings.html" class="nav-link">‚öôÔ∏è Settings</a>
      </div>
    </div>

    <!-- Summary Stats -->
    <div class="dashboard-grid">
      <div class="stat-card" style="background: linear-gradient(135deg, rgba(102, 126, 234, 0.1) 0%, rgba(118, 75, 162, 0.1) 100%);">
        <div class="stat-label">Active Experiments</div>
        <div class="stat-value" style="color: #667eea;" id="active-experiments-count">0</div>
        <div class="stat-subtitle">Hypotheses being tested</div>
      </div>

      <div class="stat-card" style="background: linear-gradient(135deg, rgba(72, 187, 120, 0.1) 0%, rgba(34, 197, 94, 0.1) 100%);">
        <div class="stat-label">Success Patterns</div>
        <div class="stat-value" style="color: #48bb78;" id="success-patterns-count">0</div>
        <div class="stat-subtitle">Working strategies (double down)</div>
      </div>

      <div class="stat-card" style="background: linear-gradient(135deg, rgba(245, 101, 101, 0.1) 0%, rgba(239, 68, 68, 0.1) 100%);">
        <div class="stat-label">Failure Patterns</div>
        <div class="stat-value" style="color: #f56565;" id="failure-patterns-count">0</div>
        <div class="stat-subtitle">Issues to fix or kill</div>
      </div>

      <div class="stat-card" style="background: linear-gradient(135deg, rgba(237, 137, 54, 0.1) 0%, rgba(251, 191, 36, 0.1) 100%);">
        <div class="stat-label">Automation Candidates</div>
        <div class="stat-value" style="color: #ed8936;" id="automation-count">0</div>
        <div class="stat-subtitle">Repetitive tasks detected (3+)</div>
      </div>
    </div>

    <!-- Experiments Section -->
    <div class="section-header">
      <h2 class="section-title">üî¨ Experiments</h2>
      <button class="btn btn-primary" onclick="runAllExperiments()">‚ñ∂Ô∏è Evaluate All</button>
    </div>
    <div id="experiments-list">
      <div class="loading">Loading experiments...</div>
    </div>

    <!-- Patterns Section -->
    <div class="section-header">
      <h2 class="section-title">üìä Detected Patterns</h2>
      <button class="btn btn-secondary" onclick="runPatternDetection()">üîç Run Detection</button>
    </div>
    <div class="pattern-grid" id="patterns-grid">
      <div class="loading">Loading patterns...</div>
    </div>

    <!-- Automation Candidates Section -->
    <div class="section-header">
      <h2 class="section-title">ü§ñ Automation Candidates</h2>
      <button class="btn btn-secondary" onclick="refreshAutomation()">üîÑ Refresh</button>
    </div>
    <div id="automation-list">
      <div class="loading">Loading automation candidates...</div>
    </div>

    <!-- Agent Performance Section -->
    <div class="section-header">
      <h2 class="section-title">üë• Agent Performance</h2>
    </div>
    <div class="agent-performance-grid" id="agent-performance">
      <div class="loading">Loading agent performance...</div>
    </div>

    <!-- LLM Cost Tracking -->
    <div class="section-header">
      <h2 class="section-title">üí∞ LLM Cost Tracking</h2>
    </div>
    <div class="card">
      <table class="cost-table" id="cost-table">
        <thead>
          <tr>
            <th>Model</th>
            <th>Usage Count</th>
            <th>Total Tokens</th>
            <th>Total Cost</th>
            <th>Avg Duration</th>
            <th>Cost %</th>
          </tr>
        </thead>
        <tbody>
          <tr><td colspan="6" class="loading">Loading cost data...</td></tr>
        </tbody>
      </table>
    </div>
  </div>

  <script>
    const REFRESH_INTERVAL = 10000; // 10 seconds

    // Initialize
    async function init() {
      await Promise.all([
        loadExperiments(),
        loadPatterns(),
        loadAutomationCandidates(),
        loadAgentPerformance(),
        loadCostStats()
      ]);

      // Auto-refresh
      setInterval(async () => {
        await Promise.all([
          loadExperiments(),
          loadPatterns(),
          loadAutomationCandidates(),
          loadAgentPerformance()
        ]);
      }, REFRESH_INTERVAL);
    }

    // Load experiments
    async function loadExperiments() {
      try {
        const response = await fetch('/api/rl/experiments');
        const experiments = await response.json();

        const container = document.getElementById('experiments-list');

        if (!experiments || experiments.length === 0) {
          container.innerHTML = `
            <div class="empty-state">
              <h3>No Experiments Yet</h3>
              <p>Experiments will appear here as the RL system learns from task execution.</p>
              <p style="margin-top: 10px; font-size: 13px;">To create an experiment, run a task multiple times and the system will automatically track its success rate.</p>
            </div>
          `;
          document.getElementById('active-experiments-count').textContent = '0';
          return;
        }

        container.innerHTML = experiments.map(exp => `
          <div class="card experiment-card ${exp.status}">
            <div class="card-header">
              <div>
                <div class="card-title">${exp.name}</div>
                <div class="card-subtitle">${exp.description || 'No description'}</div>
              </div>
              <span class="badge ${exp.status}">${exp.status}</span>
            </div>
            <div class="metric-row">
              <span class="metric-label">Success Metric</span>
              <span class="metric-value">${exp.success_metric || 'N/A'}</span>
            </div>
            <div class="metric-row">
              <span class="metric-label">Current Value</span>
              <span class="metric-value">${exp.current_value !== null ? exp.current_value : 'N/A'}</span>
            </div>
            ${exp.decision ? `
            <div class="metric-row">
              <span class="metric-label">Decision</span>
              <span class="metric-value">
                <span class="badge ${exp.decision}">${exp.decision}</span>
              </span>
            </div>
            ` : ''}
            ${exp.decision_reason ? `
            <div style="margin-top: 10px; padding: 10px; background: rgba(0,0,0,0.03); border-radius: 6px; font-size: 12px;">
              <strong>Reason:</strong> ${exp.decision_reason}
            </div>
            ` : ''}
          </div>
        `).join('');

        const activeCount = experiments.filter(e => e.status === 'active').length;
        document.getElementById('active-experiments-count').textContent = activeCount;
      } catch (error) {
        console.error('Error loading experiments:', error);
        document.getElementById('experiments-list').innerHTML = `<div class="empty-state"><h3>Error loading experiments</h3><p>${error.message}</p></div>`;
      }
    }

    // Load patterns
    async function loadPatterns() {
      try {
        const response = await fetch('/api/rl/patterns');
        const data = await response.json();

        const container = document.getElementById('patterns-grid');

        if (!data || !data.patterns || data.patterns.length === 0) {
          container.innerHTML = `
            <div class="empty-state">
              <h3>No Patterns Detected Yet</h3>
              <p>Patterns will appear as the system learns from task execution.</p>
            </div>
          `;
          document.getElementById('success-patterns-count').textContent = '0';
          document.getElementById('failure-patterns-count').textContent = '0';
          return;
        }

        container.innerHTML = data.patterns.map(pattern => {
          const typeClass = pattern.pattern_type === 'success' ? 'success' :
                           pattern.pattern_type === 'failure' ? 'failure' : 'repetition';
          return `
            <div class="pattern-card ${typeClass}">
              <div style="font-weight: 700; font-size: 14px; margin-bottom: 8px;">${pattern.title || pattern.pattern_type}</div>
              <div style="color: var(--text-secondary); font-size: 12px; margin-bottom: 10px;">${pattern.description || 'No description'}</div>
              <div style="display: flex; gap: 10px; font-size: 12px;">
                <span><strong>Detections:</strong> ${pattern.detection_count || 0}</span>
                <span><strong>Confidence:</strong> ${Math.round((pattern.confidence_score || 0) * 100)}%</span>
              </div>
              ${pattern.action_taken ? `
              <div style="margin-top: 10px;">
                <span class="badge ${pattern.action_taken === 'double_down' ? 'double-down' : 'active'}">${pattern.action_taken.replace('_', ' ')}</span>
              </div>
              ` : ''}
            </div>
          `;
        }).join('');

        const successCount = data.patterns.filter(p => p.pattern_type === 'success').length;
        const failureCount = data.patterns.filter(p => p.pattern_type === 'failure').length;
        document.getElementById('success-patterns-count').textContent = successCount;
        document.getElementById('failure-patterns-count').textContent = failureCount;
      } catch (error) {
        console.error('Error loading patterns:', error);
        document.getElementById('patterns-grid').innerHTML = `<div class="empty-state"><h3>Error loading patterns</h3><p>${error.message}</p></div>`;
      }
    }

    // Load automation candidates
    async function loadAutomationCandidates() {
      try {
        const response = await fetch('/api/rl/automation-candidates');
        const candidates = await response.json();

        const container = document.getElementById('automation-list');

        if (!candidates || candidates.length === 0) {
          container.innerHTML = `
            <div class="empty-state">
              <h3>No Automation Candidates</h3>
              <p>When you repeat the same task 3+ times, the system will suggest automating it.</p>
            </div>
          `;
          document.getElementById('automation-count').textContent = '0';
          return;
        }

        container.innerHTML = candidates.map(candidate => `
          <div class="card">
            <div class="card-header">
              <div>
                <div class="card-title">${candidate.pattern_description}</div>
                <div class="card-subtitle">Detected from ${candidate.occurrence_count} user commands</div>
              </div>
              <span class="badge ${candidate.is_automated ? 'successful' : 'active'}">
                ${candidate.is_automated ? 'Automated' : 'Pending Approval'}
              </span>
            </div>
            <div class="metric-row">
              <span class="metric-label">Occurrences</span>
              <span class="metric-value">${candidate.occurrence_count} times</span>
            </div>
            <div class="metric-row">
              <span class="metric-label">Confidence</span>
              <span class="metric-value">${Math.round((candidate.confidence_score || 0.8) * 100)}%</span>
            </div>
            ${candidate.proposed_agent_name ? `
            <div class="metric-row">
              <span class="metric-label">Proposed Agent</span>
              <span class="metric-value">${candidate.proposed_agent_name}</span>
            </div>
            ` : ''}
            ${!candidate.is_automated ? `
            <div class="action-buttons">
              <button class="btn btn-success" onclick="approveAutomation('${candidate.id}')">‚úÖ Approve & Create Agent</button>
              <button class="btn btn-secondary" onclick="dismissAutomation('${candidate.id}')">Dismiss</button>
            </div>
            ` : ''}
          </div>
        `).join('');

        const pendingCount = candidates.filter(c => !c.is_automated).length;
        document.getElementById('automation-count').textContent = pendingCount;
      } catch (error) {
        console.error('Error loading automation candidates:', error);
        document.getElementById('automation-list').innerHTML = `<div class="empty-state"><h3>Error loading automation candidates</h3><p>${error.message}</p></div>`;
      }
    }

    // Load agent performance
    async function loadAgentPerformance() {
      try {
        const response = await fetch('/api/rl/agent-performance');
        const agents = await response.json();

        const container = document.getElementById('agent-performance');

        if (!agents || agents.length === 0) {
          container.innerHTML = `
            <div class="empty-state">
              <h3>No Agent Performance Data</h3>
              <p>Agent performance metrics will appear after tasks are executed.</p>
            </div>
          `;
          return;
        }

        // Map agent names to emojis
        const agentEmojis = {
          'orchestrator': 'üéØ',
          'backend': '‚öôÔ∏è',
          'frontend': 'üé®',
          'infrastructure': 'üîß',
          'verification': '‚úÖ',
          'senior reviewer': 'üë®‚Äçüíº',
          'jarvis': 'ü§ñ',
          'shuri': 'üíé',
          'fury': 'üëÅÔ∏è',
          'vision': 'üíé',
          'loki': '‚úçÔ∏è',
          'wanda': 'üîÆ',
          'quill': 'üéµ',
          'pepper': 'üìß',
          'friday': 'üìä',
          'wong': 'üìö'
        };

        container.innerHTML = agents.map(agent => {
          // Backend returns successRate as "95%" string
          const successRateNum = parseInt(agent.successRate) || 0;
          const emoji = agentEmojis[agent.name.toLowerCase()] || 'ü§ñ';

          return `
            <div class="agent-card">
              <div class="agent-emoji">${emoji}</div>
              <div class="agent-name">${agent.name}</div>
              <div style="font-size: 12px; color: var(--text-secondary);">${agent.team}</div>
              <div class="agent-stats">
                <div style="font-size: 24px; font-weight: 800; color: ${successRateNum >= 90 ? '#48bb78' : '#667eea'};">${agent.successRate}</div>
                <div style="font-size: 12px; color: var(--text-secondary); margin-top: 5px;">${agent.tasksCompleted} tasks completed</div>
              </div>
            </div>
          `;
        }).join('');
      } catch (error) {
        console.error('Error loading agent performance:', error);
        document.getElementById('agent-performance').innerHTML = `<div class="empty-state"><h3>Error loading agent performance</h3><p>${error.message}</p></div>`;
      }
    }

    // Load cost statistics
    async function loadCostStats() {
      try {
        const response = await fetch('/api/rl/llm-stats');
        const stats = await response.json();

        const tbody = document.querySelector('#cost-table tbody');

        if (!stats || stats.length === 0) {
          tbody.innerHTML = '<tr><td colspan="6" class="empty-state">No LLM usage data yet</td></tr>';
          return;
        }

        // Calculate totals
        const totalCount = stats.reduce((sum, s) => sum + (s.usage_count || 0), 0);
        const totalTokens = stats.reduce((sum, s) => sum + (s.total_tokens || 0), 0);
        const totalCost = stats.reduce((sum, s) => sum + (s.total_cost || 0), 0);

        tbody.innerHTML = stats.map(s => {
          const costPct = totalCost > 0 ? ((s.total_cost || 0) / totalCost * 100).toFixed(1) : '0.0';
          const avgDuration = s.avg_duration_seconds
            ? `${Math.round(s.avg_duration_seconds)}s`
            : '-';
          const tokensFormatted = (s.total_tokens || 0) >= 1000000
            ? `${((s.total_tokens || 0) / 1000000).toFixed(1)}M`
            : (s.total_tokens || 0) >= 1000
            ? `${Math.round((s.total_tokens || 0) / 1000)}K`
            : (s.total_tokens || 0);

          return `
            <tr>
              <td style="font-weight: 600;">${s.llm_model || 'Unknown'}</td>
              <td>${s.usage_count || 0}</td>
              <td>${tokensFormatted}</td>
              <td style="font-weight: 700; color: #667eea;">$${(s.total_cost || 0).toFixed(2)}</td>
              <td>${avgDuration}</td>
              <td>${costPct}%</td>
            </tr>
          `;
        }).join('');

        // Add total row
        const totalTokensFormatted = totalTokens >= 1000000
          ? `${(totalTokens / 1000000).toFixed(2)}M`
          : totalTokens >= 1000
          ? `${Math.round(totalTokens / 1000)}K`
          : totalTokens;

        tbody.innerHTML += `
          <tr style="font-weight: 700; background: rgba(102, 126, 234, 0.05);">
            <td>TOTAL</td>
            <td>${totalCount}</td>
            <td>${totalTokensFormatted}</td>
            <td style="color: #667eea;">$${totalCost.toFixed(2)}</td>
            <td>-</td>
            <td>100%</td>
          </tr>
        `;
      } catch (error) {
        console.error('Error loading cost stats:', error);
        document.querySelector('#cost-table tbody').innerHTML = '<tr><td colspan="6" class="empty-state">Error loading cost data</td></tr>';
      }
    }

    // Actions
    async function runAllExperiments() {
      try {
        const response = await fetch('/api/rl/experiments/evaluate', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' }
        });

        if (!response.ok) {
          throw new Error(`HTTP ${response.status}: ${await response.text()}`);
        }

        const result = await response.json();
        alert(`‚úÖ Evaluation Complete\n\n${result.message || 'All experiments evaluated'}\n\nDecisions: ${result.decisions ? result.decisions.length : 0}`);
        await loadExperiments();
      } catch (error) {
        console.error('Error evaluating experiments:', error);
        alert(`‚ùå Error: ${error.message}`);
      }
    }

    async function runPatternDetection() {
      try {
        const response = await fetch('/api/rl/patterns/detect', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' }
        });

        if (!response.ok) {
          throw new Error(`HTTP ${response.status}: ${await response.text()}`);
        }

        const result = await response.json();
        alert(`‚úÖ Pattern Detection Complete\n\n${result.message || 'Pattern detection completed'}\n\nPatterns found: ${result.patterns ? result.patterns.length : 0}`);
        await loadPatterns();
      } catch (error) {
        console.error('Error running pattern detection:', error);
        alert(`‚ùå Error: ${error.message}`);
      }
    }

    async function refreshAutomation() {
      await loadAutomationCandidates();
    }

    async function approveAutomation(id) {
      const confirmed = confirm('‚úÖ Approve automation candidate?\n\nThis will create a new dedicated agent for this task.');
      if (!confirmed) return;

      try {
        const response = await fetch(`/api/rl/automation-candidates/${id}/approve`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' }
        });

        if (!response.ok) {
          throw new Error(`HTTP ${response.status}: ${await response.text()}`);
        }

        const result = await response.json();
        alert(`‚úÖ Automation Approved\n\n${result.message || 'Agent created successfully'}`);
        await loadAutomationCandidates();
      } catch (error) {
        console.error('Error approving automation:', error);
        alert(`‚ùå Error: ${error.message}`);
      }
    }

    async function dismissAutomation(id) {
      try {
        const response = await fetch(`/api/rl/automation-candidates/${id}/dismiss`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' }
        });

        if (!response.ok) {
          throw new Error(`HTTP ${response.status}: ${await response.text()}`);
        }

        alert('‚úÖ Automation candidate dismissed.');
        await loadAutomationCandidates();
      } catch (error) {
        console.error('Error dismissing automation:', error);
        alert(`‚ùå Error: ${error.message}`);
      }
    }

    // Initialize on load
    init();
  </script>
</body>
</html>
