<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Task Board - Agent Service</title>
  <link rel="stylesheet" href="style.css">
  <style>
    .main-container {
      max-width: 1800px;
      margin: 0 auto;
      padding: 20px;
    }

    .nav-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
      padding: 20px 30px;
      background: var(--glass-white);
      backdrop-filter: blur(var(--glass-blur)) saturate(180%);
      border: 2px solid var(--glass-border);
      border-radius: var(--border-radius-lg);
      box-shadow: var(--shadow-lg);
    }

    .nav-header h1 {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      font-weight: 800;
      margin: 0;
    }

    .nav-links {
      display: flex;
      gap: 10px;
    }

    .nav-link {
      padding: 10px 20px;
      background: rgba(102, 126, 234, 0.1);
      border: 2px solid rgba(102, 126, 234, 0.2);
      border-radius: 8px;
      color: var(--text-primary);
      text-decoration: none;
      font-weight: 600;
      transition: all 0.2s;
    }

    .nav-link:hover {
      background: rgba(102, 126, 234, 0.2);
      transform: translateY(-2px);
    }

    .nav-link.active {
      background: #667eea;
      color: white;
      border-color: #667eea;
    }

    .filters {
      display: flex;
      gap: 15px;
      margin-bottom: 25px;
      padding: 20px;
      background: var(--glass-light);
      border: 2px solid var(--glass-border);
      border-radius: var(--border-radius);
    }

    .filter-group {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .filter-group label {
      font-weight: 600;
      color: var(--text-secondary);
      font-size: 14px;
    }

    .filter-group select {
      padding: 8px 14px;
      background: var(--glass-white);
      border: 2px solid var(--glass-border);
      border-radius: 6px;
      color: var(--text-primary);
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
    }

    .kanban-board {
      display: grid;
      grid-template-columns: repeat(5, 1fr);
      gap: 20px;
      margin-bottom: 30px;
    }

    .kanban-column {
      background: var(--glass-light);
      border: 2px solid var(--glass-border);
      border-radius: var(--border-radius);
      padding: 15px;
      min-height: 500px;
    }

    .column-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 15px;
      padding-bottom: 10px;
      border-bottom: 3px solid var(--glass-border);
    }

    .column-title {
      font-size: 16px;
      font-weight: 800;
      color: var(--text-primary);
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .column-count {
      background: rgba(102, 126, 234, 0.2);
      color: #667eea;
      padding: 4px 10px;
      border-radius: 12px;
      font-size: 12px;
      font-weight: 700;
    }

    .task-card {
      background: var(--glass-white);
      border: 2px solid var(--glass-border);
      border-radius: 10px;
      padding: 15px;
      margin-bottom: 12px;
      cursor: pointer;
      transition: all 0.2s;
      box-shadow: var(--shadow-sm);
    }

    .task-card:hover {
      transform: translateY(-2px);
      box-shadow: var(--shadow-md);
      border-color: #667eea;
    }

    .task-card.priority-high {
      border-left: 4px solid #f56565;
    }

    .task-card.priority-medium {
      border-left: 4px solid #f59e0b;
    }

    .task-card.priority-low {
      border-left: 4px solid #48bb78;
    }

    .task-description {
      font-size: 14px;
      font-weight: 600;
      color: var(--text-primary);
      margin-bottom: 10px;
      line-height: 1.4;
      display: -webkit-box;
      -webkit-line-clamp: 3;
      -webkit-box-orient: vertical;
      overflow: hidden;
    }

    .task-meta {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin-top: 10px;
    }

    .task-tag {
      font-size: 11px;
      padding: 4px 8px;
      border-radius: 4px;
      font-weight: 600;
    }

    .task-agent {
      background: rgba(102, 126, 234, 0.15);
      color: #667eea;
    }

    .task-session {
      background: rgba(118, 75, 162, 0.15);
      color: #764ba2;
    }

    .task-llm {
      background: rgba(245, 158, 11, 0.15);
      color: #f59e0b;
    }

    .task-time {
      font-size: 11px;
      color: var(--text-muted);
      margin-top: 8px;
    }

    /* Status-specific column colors */
    .kanban-column.pending .column-title {
      color: #94a3b8;
    }

    .kanban-column.in_progress .column-title {
      color: #3b82f6;
    }

    .kanban-column.completed .column-title {
      color: #48bb78;
    }

    .kanban-column.failed .column-title {
      color: #f56565;
    }

    .kanban-column.blocked .column-title {
      color: #f59e0b;
    }

    .empty-column {
      text-align: center;
      padding: 40px 20px;
      color: var(--text-muted);
      font-size: 14px;
      opacity: 0.6;
    }

    .stats-bar {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 15px;
      margin-bottom: 25px;
    }

    .stat-card {
      background: var(--glass-light);
      border: 2px solid var(--glass-border);
      border-radius: var(--border-radius);
      padding: 20px;
      text-align: center;
    }

    .stat-value {
      font-size: 32px;
      font-weight: 800;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }

    .stat-label {
      font-size: 13px;
      color: var(--text-secondary);
      font-weight: 600;
      margin-top: 5px;
    }
  </style>
</head>
<body>
  <div class="main-container">
    <!-- Navigation Header -->
    <div class="nav-header">
      <h1 style="margin: 0;">üìã Task Board</h1>
      <div class="nav-links">
        <a href="/management-team.html" class="nav-link">Management</a>
        <a href="/engineering.html" class="nav-link">Engineering</a>
        <a href="/sales-marketing.html" class="nav-link">Sales & Marketing</a>
        <a href="/rl-dashboard.html" class="nav-link">RL Dashboard</a>
        <a href="/kanban.html" class="nav-link active">Task Board</a>
        <a href="/commands.html" class="nav-link">Docs & Commands</a>
        <a href="/settings.html" class="nav-link">‚öôÔ∏è Settings</a>
      </div>
    </div>

    <!-- Stats Bar -->
    <div class="stats-bar">
      <div class="stat-card">
        <div class="stat-value" id="total-tasks">0</div>
        <div class="stat-label">Total Tasks</div>
      </div>
      <div class="stat-card">
        <div class="stat-value" id="active-tasks">0</div>
        <div class="stat-label">Active</div>
      </div>
      <div class="stat-card">
        <div class="stat-value" id="completed-tasks">0</div>
        <div class="stat-label">Completed</div>
      </div>
      <div class="stat-card">
        <div class="stat-value" id="failed-tasks">0</div>
        <div class="stat-label">Failed</div>
      </div>
    </div>

    <!-- Filters -->
    <div class="filters">
      <div class="filter-group">
        <label>Team:</label>
        <select id="team-filter" onchange="loadTasks()">
          <option value="">All Teams</option>
          <option value="team-management">Management</option>
          <option value="team-engineering">Engineering</option>
          <option value="team-marketing">Marketing</option>
        </select>
      </div>
      <div class="filter-group">
        <label>Agent:</label>
        <select id="agent-filter" onchange="loadTasks()">
          <option value="">All Agents</option>
        </select>
      </div>
      <div class="filter-group">
        <label>Session:</label>
        <select id="session-filter" onchange="loadTasks()">
          <option value="">All Sessions</option>
        </select>
      </div>
      <button class="btn btn-primary" onclick="loadTasks()" style="margin-left: auto;">üîÑ Refresh</button>
    </div>

    <!-- Kanban Board -->
    <div class="kanban-board">
      <div class="kanban-column pending">
        <div class="column-header">
          <div class="column-title">‚è≥ Pending</div>
          <div class="column-count" id="pending-count">0</div>
        </div>
        <div id="pending-tasks"></div>
      </div>

      <div class="kanban-column in_progress">
        <div class="column-header">
          <div class="column-title">üöÄ In Progress</div>
          <div class="column-count" id="in_progress-count">0</div>
        </div>
        <div id="in_progress-tasks"></div>
      </div>

      <div class="kanban-column completed">
        <div class="column-header">
          <div class="column-title">‚úÖ Completed</div>
          <div class="column-count" id="completed-count">0</div>
        </div>
        <div id="completed-tasks"></div>
      </div>

      <div class="kanban-column failed">
        <div class="column-header">
          <div class="column-title">‚ùå Failed</div>
          <div class="column-count" id="failed-count">0</div>
        </div>
        <div id="failed-tasks"></div>
      </div>

      <div class="kanban-column blocked">
        <div class="column-header">
          <div class="column-title">üöß Blocked</div>
          <div class="column-count" id="blocked-count">0</div>
        </div>
        <div id="blocked-tasks"></div>
      </div>
    </div>
  </div>

  <script>
    let allTasks = [];
    let allAgents = [];
    let allSessions = [];

    async function loadAgents() {
      try {
        const response = await fetch('/api/agents');
        allAgents = await response.json();

        const agentFilter = document.getElementById('agent-filter');
        allAgents.forEach(agent => {
          const option = document.createElement('option');
          option.value = agent.id;
          option.textContent = `${agent.emoji} ${agent.name}`;
          agentFilter.appendChild(option);
        });
      } catch (error) {
        console.error('Error loading agents:', error);
      }
    }

    async function loadSessions() {
      try {
        const response = await fetch('/api/sessions');
        const data = await response.json();
        allSessions = Array.isArray(data) ? data : data.sessions || [];

        const sessionFilter = document.getElementById('session-filter');
        allSessions.slice(0, 20).forEach(session => {
          const option = document.createElement('option');
          option.value = session.id;
          option.textContent = `${session.id} (${session.team_name || session.team_id})`;
          sessionFilter.appendChild(option);
        });
      } catch (error) {
        console.error('Error loading sessions:', error);
      }
    }

    async function loadTasks() {
      try {
        const teamFilter = document.getElementById('team-filter').value;
        const agentFilter = document.getElementById('agent-filter').value;
        const sessionFilter = document.getElementById('session-filter').value;

        let url = '/api/tasks';
        const params = new URLSearchParams();
        if (teamFilter) params.append('team_id', teamFilter);
        if (agentFilter) params.append('agent_id', agentFilter);
        if (sessionFilter) params.append('session_id', sessionFilter);

        if (params.toString()) {
          url += '?' + params.toString();
        }

        const response = await fetch(url);
        allTasks = await response.json();

        renderKanban();
        updateStats();
      } catch (error) {
        console.error('Error loading tasks:', error);
      }
    }

    function renderKanban() {
      const statuses = ['pending', 'in_progress', 'completed', 'failed', 'blocked'];

      statuses.forEach(status => {
        const tasks = allTasks.filter(t => t.status === status);
        const container = document.getElementById(`${status}-tasks`);
        const countEl = document.getElementById(`${status}-count`);

        countEl.textContent = tasks.length;

        if (tasks.length === 0) {
          container.innerHTML = '<div class="empty-column">No tasks</div>';
          return;
        }

        container.innerHTML = tasks.map(task => {
          const agent = allAgents.find(a => a.id === task.agent_id);
          const agentEmoji = agent ? agent.emoji : 'ü§ñ';
          const agentName = agent ? agent.name : task.agent_id;
          const teamName = task.team_name || 'Unknown Team';

          const startedAt = task.started_at ? new Date(task.started_at) : null;
          const completedAt = task.completed_at ? new Date(task.completed_at) : null;
          const timeAgo = startedAt ? getTimeAgo(startedAt) : 'Not started';

          // Format session ID for display
          const sessionShort = task.session_id.replace('session-', '').substring(0, 10);

          // Priority indicator
          const priorityColors = {
            'high': '#f56565',
            'medium': '#f59e0b',
            'low': '#48bb78'
          };
          const priorityColor = priorityColors[task.priority] || priorityColors.medium;

          // Duration display
          let durationText = '';
          if (task.duration_seconds) {
            const duration = Math.round(task.duration_seconds);
            if (duration < 60) durationText = `${duration}s`;
            else if (duration < 3600) durationText = `${Math.floor(duration / 60)}m`;
            else durationText = `${Math.floor(duration / 3600)}h ${Math.floor((duration % 3600) / 60)}m`;
          }

          return `
            <div class="task-card priority-${task.priority || 'medium'}" onclick="viewTask('${task.id}')" style="cursor: pointer;">
              <!-- Priority Indicator -->
              <div style="width: 4px; height: 100%; position: absolute; left: 0; top: 0; background: ${priorityColor}; border-radius: 8px 0 0 8px;"></div>

              <!-- Task Header -->
              <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 10px;">
                <div style="font-size: 32px; line-height: 1;">${agentEmoji}</div>
                <div style="flex: 1;">
                  <div style="font-weight: 700; font-size: 14px; color: var(--text-primary); margin-bottom: 2px;">
                    ${agentName}
                  </div>
                  <div style="font-size: 11px; color: var(--text-secondary); text-transform: uppercase; letter-spacing: 0.5px;">
                    ${teamName}
                  </div>
                </div>
              </div>

              <!-- Task Description -->
              <div style="font-size: 13px; color: var(--text-primary); margin-bottom: 12px; line-height: 1.4;">
                ${task.description || 'No description'}
              </div>

              <!-- Task Meta -->
              <div style="display: flex; flex-wrap: wrap; gap: 6px; margin-bottom: 10px;">
                ${task.llm_used ? `<span class="task-tag" style="background: rgba(102, 126, 234, 0.15); color: #667eea; font-size: 11px; padding: 4px 8px; border-radius: 4px; font-weight: 600;">${task.llm_used}</span>` : ''}
                <span class="task-tag" style="background: rgba(255, 255, 255, 0.05); color: var(--text-secondary); font-size: 11px; padding: 4px 8px; border-radius: 4px;">
                  ${sessionShort}
                </span>
                ${durationText ? `<span class="task-tag" style="background: rgba(72, 187, 120, 0.15); color: #48bb78; font-size: 11px; padding: 4px 8px; border-radius: 4px; font-weight: 600;">‚è± ${durationText}</span>` : ''}
              </div>

              <!-- Task Footer -->
              <div style="display: flex; justify-content: space-between; align-items: center; padding-top: 10px; border-top: 1px solid rgba(255, 255, 255, 0.1);">
                <div style="font-size: 11px; color: var(--text-muted);">
                  ${timeAgo}
                </div>
                ${task.error_message ? `<div style="font-size: 11px; color: #f56565; font-weight: 600;">‚ö†Ô∏è Error</div>` : ''}
              </div>
            </div>
          `;
        }).join('');
      });

      updateStats();
    }

    function updateStats() {
      const total = allTasks.length;
      const active = allTasks.filter(t => t.status === 'in_progress').length;
      const completed = allTasks.filter(t => t.status === 'completed').length;
      const failed = allTasks.filter(t => t.status === 'failed').length;

      document.getElementById('total-tasks').textContent = total;
      document.getElementById('active-tasks').textContent = active;
      document.getElementById('completed-tasks').textContent = completed;
      document.getElementById('failed-tasks').textContent = failed;
    }

    function getTimeAgo(date) {
      const seconds = Math.floor((new Date() - date) / 1000);
      if (seconds < 60) return `${seconds}s ago`;
      if (seconds < 3600) return `${Math.floor(seconds / 60)}m ago`;
      if (seconds < 86400) return `${Math.floor(seconds / 3600)}h ago`;
      return `${Math.floor(seconds / 86400)}d ago`;
    }

    function viewTask(taskId) {
      const task = allTasks.find(t => t.id === taskId);
      if (!task) return;

      const agent = allAgents.find(a => a.id === task.agent_id);
      const agentEmoji = agent ? agent.emoji : 'ü§ñ';
      const agentName = agent ? agent.name : task.agent_id;
      const agentRole = agent ? agent.role : 'Unknown';
      const teamName = task.team_name || 'Unknown Team';

      const startedAt = task.started_at ? new Date(task.started_at).toLocaleString() : 'Not started';
      const completedAt = task.completed_at ? new Date(task.completed_at).toLocaleString() : 'Not completed';

      // Duration display
      let durationText = 'N/A';
      if (task.duration_seconds) {
        const duration = Math.round(task.duration_seconds);
        if (duration < 60) durationText = `${duration} seconds`;
        else if (duration < 3600) durationText = `${Math.floor(duration / 60)} minutes ${duration % 60} seconds`;
        else durationText = `${Math.floor(duration / 3600)} hours ${Math.floor((duration % 3600) / 60)} minutes`;
      }

      // Status badge color
      const statusColors = {
        'pending': '#f59e0b',
        'in_progress': '#667eea',
        'completed': '#48bb78',
        'failed': '#f56565',
        'blocked': '#ed8936'
      };
      const statusColor = statusColors[task.status] || '#cbd5e0';

      // Priority badge color
      const priorityColors = {
        'high': '#f56565',
        'medium': '#f59e0b',
        'low': '#48bb78'
      };
      const priorityColor = priorityColors[task.priority] || priorityColors.medium;

      // Create modal
      const modal = document.createElement('div');
      modal.style.cssText = `
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.7);
        backdrop-filter: blur(10px);
        display: flex;
        align-items: center;
        justify-content: center;
        z-index: 10000;
        animation: fadeIn 0.2s ease-out;
      `;

      modal.innerHTML = `
        <style>
          @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
          }
          @keyframes slideUp {
            from { transform: translateY(20px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
          }
        </style>
        <div style="
          background: linear-gradient(135deg, rgba(102, 126, 234, 0.1) 0%, rgba(118, 75, 162, 0.1) 100%);
          backdrop-filter: blur(20px);
          border: 2px solid rgba(255, 255, 255, 0.1);
          border-radius: 20px;
          padding: 0;
          max-width: 600px;
          width: 90%;
          max-height: 80vh;
          overflow: hidden;
          box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5);
          animation: slideUp 0.3s ease-out;
        ">
          <!-- Modal Header -->
          <div style="
            padding: 30px;
            border-bottom: 2px solid rgba(255, 255, 255, 0.1);
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.2) 0%, rgba(118, 75, 162, 0.2) 100%);
          ">
            <div style="display: flex; align-items: flex-start; gap: 20px;">
              <div style="font-size: 64px; line-height: 1;">${agentEmoji}</div>
              <div style="flex: 1;">
                <h2 style="margin: 0 0 8px 0; font-size: 24px; font-weight: 800; color: var(--text-primary);">
                  ${agentName}
                </h2>
                <div style="font-size: 14px; color: var(--text-secondary); margin-bottom: 8px;">
                  ${agentRole} ‚Ä¢ ${teamName}
                </div>
                <div style="display: flex; gap: 8px; flex-wrap: wrap;">
                  <span style="background: ${statusColor}; color: white; padding: 6px 12px; border-radius: 6px; font-size: 12px; font-weight: 700; text-transform: uppercase;">
                    ${task.status.replace('_', ' ')}
                  </span>
                  <span style="background: ${priorityColor}; color: white; padding: 6px 12px; border-radius: 6px; font-size: 12px; font-weight: 700; text-transform: uppercase;">
                    ${task.priority || 'medium'} priority
                  </span>
                </div>
              </div>
              <button onclick="this.closest('[style*=fixed]').remove()" style="
                background: rgba(255, 255, 255, 0.1);
                border: none;
                color: var(--text-primary);
                font-size: 24px;
                width: 40px;
                height: 40px;
                border-radius: 8px;
                cursor: pointer;
                transition: all 0.2s;
              " onmouseover="this.style.background='rgba(255, 255, 255, 0.2)'" onmouseout="this.style.background='rgba(255, 255, 255, 0.1)'">
                √ó
              </button>
            </div>
          </div>

          <!-- Modal Body -->
          <div style="padding: 30px; overflow-y: auto; max-height: calc(80vh - 200px);">
            <!-- Task Description -->
            <div style="margin-bottom: 25px;">
              <h3 style="font-size: 14px; font-weight: 700; color: var(--text-secondary); text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 10px;">
                Task Description
              </h3>
              <div style="
                background: rgba(255, 255, 255, 0.05);
                border: 2px solid rgba(255, 255, 255, 0.1);
                border-radius: 10px;
                padding: 15px;
                font-size: 15px;
                line-height: 1.6;
                color: var(--text-primary);
              ">
                ${task.description || 'No description provided'}
              </div>
            </div>

            <!-- Task Details Grid -->
            <div style="margin-bottom: 25px;">
              <h3 style="font-size: 14px; font-weight: 700; color: var(--text-secondary); text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 10px;">
                Details
              </h3>
              <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px;">
                <!-- Task ID -->
                <div style="background: rgba(255, 255, 255, 0.05); border: 2px solid rgba(255, 255, 255, 0.1); border-radius: 10px; padding: 15px;">
                  <div style="font-size: 11px; color: var(--text-muted); margin-bottom: 6px; text-transform: uppercase; letter-spacing: 0.5px;">Task ID</div>
                  <div style="font-size: 13px; color: var(--text-primary); font-family: monospace;">${task.id.substring(0, 25)}...</div>
                </div>

                <!-- Session ID -->
                <div style="background: rgba(255, 255, 255, 0.05); border: 2px solid rgba(255, 255, 255, 0.1); border-radius: 10px; padding: 15px;">
                  <div style="font-size: 11px; color: var(--text-muted); margin-bottom: 6px; text-transform: uppercase; letter-spacing: 0.5px;">Session</div>
                  <div style="font-size: 13px; color: var(--text-primary); font-family: monospace;">${task.session_id.replace('session-', '')}</div>
                </div>

                <!-- LLM Used -->
                <div style="background: rgba(102, 126, 234, 0.1); border: 2px solid rgba(102, 126, 234, 0.2); border-radius: 10px; padding: 15px;">
                  <div style="font-size: 11px; color: var(--text-muted); margin-bottom: 6px; text-transform: uppercase; letter-spacing: 0.5px;">LLM Model</div>
                  <div style="font-size: 14px; color: #667eea; font-weight: 700;">${task.llm_used || 'Not specified'}</div>
                </div>

                <!-- Duration -->
                <div style="background: rgba(72, 187, 120, 0.1); border: 2px solid rgba(72, 187, 120, 0.2); border-radius: 10px; padding: 15px;">
                  <div style="font-size: 11px; color: var(--text-muted); margin-bottom: 6px; text-transform: uppercase; letter-spacing: 0.5px;">Duration</div>
                  <div style="font-size: 14px; color: #48bb78; font-weight: 700;">‚è± ${durationText}</div>
                </div>
              </div>
            </div>

            <!-- Timestamps -->
            <div style="margin-bottom: 25px;">
              <h3 style="font-size: 14px; font-weight: 700; color: var(--text-secondary); text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 10px;">
                Timeline
              </h3>
              <div style="background: rgba(255, 255, 255, 0.05); border: 2px solid rgba(255, 255, 255, 0.1); border-radius: 10px; padding: 15px;">
                <div style="display: flex; justify-content: space-between; margin-bottom: 12px;">
                  <span style="font-size: 13px; color: var(--text-secondary);">Started:</span>
                  <span style="font-size: 13px; color: var(--text-primary); font-weight: 600;">${startedAt}</span>
                </div>
                <div style="display: flex; justify-content: space-between;">
                  <span style="font-size: 13px; color: var(--text-secondary);">Completed:</span>
                  <span style="font-size: 13px; color: var(--text-primary); font-weight: 600;">${completedAt}</span>
                </div>
              </div>
            </div>

            ${task.error_message ? `
            <!-- Error Message -->
            <div style="margin-bottom: 25px;">
              <h3 style="font-size: 14px; font-weight: 700; color: #f56565; text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 10px;">
                ‚ö†Ô∏è Error Details
              </h3>
              <div style="
                background: rgba(245, 101, 101, 0.1);
                border: 2px solid rgba(245, 101, 101, 0.3);
                border-radius: 10px;
                padding: 15px;
                font-size: 14px;
                line-height: 1.6;
                color: #f56565;
                font-family: monospace;
              ">
                ${task.error_message}
              </div>
            </div>
            ` : ''}

            ${task.retry_count > 0 ? `
            <!-- Retry Info -->
            <div style="margin-bottom: 25px;">
              <div style="
                background: rgba(251, 191, 36, 0.1);
                border: 2px solid rgba(251, 191, 36, 0.3);
                border-radius: 10px;
                padding: 12px 15px;
                font-size: 13px;
                color: #f59e0b;
              ">
                üîÑ Retried ${task.retry_count} time${task.retry_count > 1 ? 's' : ''}
              </div>
            </div>
            ` : ''}
          </div>

          <!-- Modal Footer -->
          <div style="
            padding: 20px 30px;
            border-top: 2px solid rgba(255, 255, 255, 0.1);
            display: flex;
            justify-content: flex-end;
            gap: 10px;
          ">
            <button onclick="window.open('/engineering.html', '_blank')" style="
              background: rgba(102, 126, 234, 0.2);
              border: 2px solid rgba(102, 126, 234, 0.3);
              color: #667eea;
              padding: 10px 20px;
              border-radius: 8px;
              font-weight: 700;
              cursor: pointer;
              font-size: 14px;
              transition: all 0.2s;
            " onmouseover="this.style.background='rgba(102, 126, 234, 0.3)'" onmouseout="this.style.background='rgba(102, 126, 234, 0.2)'">
              View Session
            </button>
            <button onclick="this.closest('[style*=fixed]').remove()" style="
              background: rgba(255, 255, 255, 0.1);
              border: 2px solid rgba(255, 255, 255, 0.2);
              color: var(--text-primary);
              padding: 10px 20px;
              border-radius: 8px;
              font-weight: 700;
              cursor: pointer;
              font-size: 14px;
              transition: all 0.2s;
            " onmouseover="this.style.background='rgba(255, 255, 255, 0.15)'" onmouseout="this.style.background='rgba(255, 255, 255, 0.1)'">
              Close
            </button>
          </div>
        </div>
      `;

      // Close modal on background click
      modal.addEventListener('click', (e) => {
        if (e.target === modal) {
          modal.remove();
        }
      });

      // Close modal on ESC key
      const escHandler = (e) => {
        if (e.key === 'Escape') {
          modal.remove();
          document.removeEventListener('keydown', escHandler);
        }
      };
      document.addEventListener('keydown', escHandler);

      document.body.appendChild(modal);
    }

    // Load data on page load
    loadAgents().then(() => loadSessions()).then(() => loadTasks());

    // Auto-refresh every 10 seconds
    setInterval(loadTasks, 10000);
  </script>
</body>
</html>
