<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Sales & Marketing Team - Agent Service</title>
  <link rel="stylesheet" href="style.css">
  <style>
    .marketing-container {
      max-width: 1800px;
      margin: 0 auto;
      padding: 20px;
    }

    .nav-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
      padding: 20px 30px;
      background: var(--glass-white);
      backdrop-filter: blur(var(--glass-blur)) saturate(180%);
      border: 2px solid var(--glass-border);
      border-radius: var(--border-radius-lg);
      box-shadow: var(--shadow-lg);
    }

    .nav-header h1 {
      background: linear-gradient(135deg, #48bb78 0%, #38a169 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      font-weight: 800;
    }

    .nav-links {
      display: flex;
      gap: 10px;
    }

    .nav-link {
      padding: 10px 20px;
      background: rgba(102, 126, 234, 0.1);
      border: 2px solid rgba(102, 126, 234, 0.2);
      border-radius: 8px;
      color: var(--text-primary);
      text-decoration: none;
      font-weight: 600;
      transition: all 0.2s;
    }

    .nav-link:hover {
      background: rgba(102, 126, 234, 0.2);
      transform: translateY(-2px);
    }

    .nav-link.active {
      background: #48bb78;
      color: white;
      border-color: #48bb78;
    }

    .control-panel {
      background: var(--glass-light);
      border: 2px solid var(--glass-border);
      border-radius: var(--border-radius);
      padding: 25px;
      margin-bottom: 30px;
    }

    .start-job-form {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 15px;
      margin-bottom: 20px;
    }

    .form-group {
      display: flex;
      flex-direction: column;
    }

    .form-group label {
      font-size: 13px;
      font-weight: 600;
      margin-bottom: 8px;
      color: var(--text-secondary);
    }

    .form-group input,
    .form-group select,
    .form-group textarea {
      padding: 10px;
      border: 2px solid rgba(72, 187, 120, 0.2);
      border-radius: 8px;
      font-size: 14px;
    }

    .agents-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
      gap: 20px;
      margin-bottom: 30px;
    }

    .agent-card {
      background: var(--glass-light);
      backdrop-filter: blur(15px);
      border: 2px solid var(--glass-border);
      border-radius: var(--border-radius);
      padding: 20px;
      box-shadow: var(--shadow-md);
      transition: all 0.3s;
      text-align: center;
    }

    .agent-card:hover {
      transform: translateY(-4px);
      box-shadow: var(--shadow-lg);
    }

    .agent-emoji {
      font-size: 56px;
      margin-bottom: 10px;
    }

    .agent-name {
      font-size: 18px;
      font-weight: 700;
      margin-bottom: 5px;
    }

    .agent-role {
      font-size: 12px;
      color: var(--text-secondary);
      font-weight: 600;
      margin-bottom: 15px;
    }

    .agent-stats {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 10px;
      margin: 15px 0;
    }

    .stat-item {
      padding: 8px;
      background: rgba(255, 255, 255, 0.5);
      border-radius: 8px;
    }

    .stat-value {
      font-size: 18px;
      font-weight: 800;
      color: var(--text-primary);
    }

    .stat-label {
      font-size: 10px;
      color: var(--text-secondary);
      margin-top: 4px;
    }

    .btn {
      padding: 10px 16px;
      border: none;
      border-radius: 6px;
      font-size: 13px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s;
      width: 100%;
    }

    .btn:hover {
      transform: translateY(-2px);
      box-shadow: var(--shadow-md);
    }

    .btn-primary {
      background: #667eea;
      color: white;
    }

    .btn-success {
      background: #48bb78;
      color: white;
    }

    .btn-danger {
      background: #f56565;
      color: white;
    }

    .section-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin: 40px 0 20px;
    }

    .section-title {
      font-size: 24px;
      font-weight: 700;
      color: var(--text-primary);
    }

    .data-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
      gap: 20px;
    }

    .data-card {
      background: white;
      border: 2px solid rgba(72, 187, 120, 0.1);
      border-radius: 10px;
      padding: 20px;
    }

    .data-card h4 {
      font-size: 16px;
      font-weight: 700;
      margin-bottom: 15px;
      color: #48bb78;
    }

    .data-list {
      display: flex;
      flex-direction: column;
      gap: 10px;
    }

    .data-item {
      padding: 10px;
      background: rgba(72, 187, 120, 0.05);
      border-radius: 6px;
      font-size: 13px;
    }

    .badge {
      padding: 4px 12px;
      border-radius: 12px;
      font-size: 11px;
      font-weight: 700;
      text-transform: uppercase;
      margin-left: 10px;
    }

    .badge.running { background: rgba(102, 126, 234, 0.2); color: #667eea; }
    .badge.completed { background: rgba(72, 187, 120, 0.2); color: #48bb78; }
    .badge.failed { background: rgba(245, 101, 101, 0.2); color: #f56565; }
  </style>
</head>
<body>
  <div class="marketing-container">
    <!-- Navigation Header -->
    <div class="nav-header">
      <h1 style="margin: 0;">üìä Sales & Marketing Team</h1>
      <div class="nav-links">
        <a href="/management-team.html" class="nav-link">Management</a>
        <a href="/engineering.html" class="nav-link">Engineering</a>
        <a href="/sales-marketing.html" class="nav-link active">Sales & Marketing</a>
        <a href="/rl-dashboard.html" class="nav-link">RL Dashboard</a>
        <a href="/kanban.html" class="nav-link">üìã Task Board</a>
        <a href="/commands.html" class="nav-link">Docs & Commands</a>
        <a href="/settings.html" class="nav-link">‚öôÔ∏è Settings</a>
      </div>
    </div>

    <!-- Job Control Panel -->
    <div class="control-panel">
      <h2 style="margin-bottom: 20px;">üöÄ Start Marketing Campaign</h2>
      <div class="start-job-form">
        <div class="form-group">
          <label>Model</label>
          <select id="model-select">
            <option value="sonnet">Sonnet 4.5 (Recommended)</option>
            <option value="opus">Opus 4.5 (Most Capable)</option>
            <option value="haiku">Haiku 3.5 (Fast & Efficient)</option>
          </select>
        </div>
        <div class="form-group">
          <label>Campaign File</label>
          <input type="text" id="priority-file" placeholder="reports/marketing-campaign-Q1.md">
        </div>
        <div class="form-group">
          <label>Branch Name</label>
          <input type="text" id="branch-name" placeholder="feature/q1-campaign">
        </div>
        <div class="form-group" style="grid-column: 1/-1;">
          <label>Campaign Description</label>
          <textarea id="campaign-desc" rows="3" placeholder="Describe the marketing campaign objectives..."></textarea>
        </div>
      </div>
      <button class="btn btn-success" onclick="startMarketingJob()">üöÄ Start Marketing Campaign</button>
    </div>

    <!-- Marketing Agents Grid -->
    <div class="section-header">
      <h2 class="section-title">ü¶∏ Marketing Avengers</h2>
      <button class="btn btn-primary" onclick="refreshAgents()" style="width: auto; padding: 10px 20px;">üîÑ Refresh</button>
    </div>
    <div class="agents-grid" id="agents-grid">
      <div style="text-align: center; padding: 40px;">Loading agents...</div>
    </div>

    <!-- Marketing Data Overview -->
    <div class="section-header">
      <h2 class="section-title">üìà Marketing Data</h2>
      <button class="btn btn-primary" onclick="refreshData()" style="width: auto; padding: 10px 20px;">üîÑ Refresh</button>
    </div>
    <div class="data-grid">
      <div class="data-card">
        <h4>üìß Recent Leads</h4>
        <div class="data-list" id="leads-list">
          <div style="text-align: center; padding: 20px; color: var(--text-muted);">No leads yet</div>
        </div>
      </div>
      <div class="data-card">
        <h4>üì¢ Active Campaigns</h4>
        <div class="data-list" id="campaigns-list">
          <div style="text-align: center; padding: 20px; color: var(--text-muted);">No campaigns yet</div>
        </div>
      </div>
      <div class="data-card">
        <h4>üì± Social Posts</h4>
        <div class="data-list" id="social-list">
          <div style="text-align: center; padding: 20px; color: var(--text-muted);">No social posts yet</div>
        </div>
      </div>
    </div>
  </div>

  <script>
    // Initialize
    async function init() {
      await Promise.all([
        loadAgents(),
        loadMarketingData()
      ]);

      // Auto-refresh every 10 seconds
      setInterval(async () => {
        await Promise.all([
          loadAgents(),
          loadMarketingData()
        ]);
      }, 10000);
    }

    // Load marketing agents
    async function loadAgents() {
      try {
        const response = await fetch('/api/rl/agent-performance');
        const allAgents = await response.json();
        const mktAgents = allAgents.filter(a => a.team === 'Marketing');

        const agentInfo = {
          'Jarvis': { emoji: 'ü§ñ', role: 'Campaign Orchestrator & AI Lead' },
          'Shuri': { emoji: 'üíé', role: 'Tech Integration & Innovation' },
          'Fury': { emoji: 'üëÅÔ∏è', role: 'Strategy & Intelligence' },
          'Vision': { emoji: 'üíé', role: 'SEO & Analytics' },
          'Loki': { emoji: '‚úçÔ∏è', role: 'Content Creation & Copywriting' },
          'Wanda': { emoji: 'üîÆ', role: 'Brand & Creative Direction' },
          'Quill': { emoji: 'üéµ', role: 'Social Media & Community' },
          'Pepper': { emoji: 'üìß', role: 'Email Marketing & Automation' },
          'Friday': { emoji: 'üìä', role: 'Data & Reporting' },
          'Wong': { emoji: 'üìö', role: 'Knowledge Management' }
        };

        const container = document.getElementById('agents-grid');

        if (!mktAgents || mktAgents.length === 0) {
          container.innerHTML = '<div style="text-align: center; padding: 40px;">No marketing agents found</div>';
          return;
        }

        container.innerHTML = mktAgents.map(agent => {
          const info = agentInfo[agent.name] || { emoji: 'ü§ñ', role: 'Marketing Specialist' };
          const successRate = parseInt(agent.successRate) || 0;
          const statusColor = successRate >= 90 ? '#48bb78' : successRate >= 70 ? '#667eea' : '#f59e0b';

          return `
            <div class="agent-card">
              <div class="agent-emoji">${info.emoji}</div>
              <div class="agent-name">${agent.name}</div>
              <div class="agent-role">${info.role}</div>
              <div class="agent-stats">
                <div class="stat-item">
                  <div class="stat-value" style="color: ${statusColor};">${agent.successRate}</div>
                  <div class="stat-label">Success Rate</div>
                </div>
                <div class="stat-item">
                  <div class="stat-value">${agent.tasksCompleted}</div>
                  <div class="stat-label">Tasks Done</div>
                </div>
              </div>
              <button class="btn btn-primary" onclick="viewAgentDetails('${agent.name}')">üìä View Details</button>
            </div>
          `;
        }).join('');
      } catch (error) {
        console.error('Error loading agents:', error);
      }
    }

    // Load marketing data (DATABASE ONLY - NO MOCKUP DATA)
    async function loadMarketingData() {
      try {
        // Load leads from database
        const leadsResponse = await fetch('/api/data/leads');
        const leads = await leadsResponse.json();
        const leadsList = document.getElementById('leads-list');

        if (leads && leads.length > 0) {
          leadsList.innerHTML = leads.slice(0, 5).map(lead => `
            <div class="data-item">
              <strong>${lead.contact_email || lead.contact_name || 'Unknown Lead'}</strong><br>
              <span style="font-size: 11px; color: var(--text-secondary);">
                Source: ${lead.source || 'N/A'} |
                Score: ${lead.score || 0} |
                Status: ${lead.status || 'new'}
                ${lead.assigned_to_name ? ` | ${lead.assigned_to_emoji} ${lead.assigned_to_name}` : ''}
              </span>
            </div>
          `).join('');
        } else {
          leadsList.innerHTML = '<div style="text-align: center; padding: 20px; color: var(--text-muted);">No leads yet</div>';
        }

        // Load campaigns from database
        const campaignsResponse = await fetch('/api/data/campaigns');
        const campaigns = await campaignsResponse.json();
        const campaignsList = document.getElementById('campaigns-list');

        if (campaigns && campaigns.length > 0) {
          campaignsList.innerHTML = campaigns.slice(0, 5).map(campaign => `
            <div class="data-item">
              <strong>${campaign.name || 'Untitled Campaign'}</strong><br>
              <span style="font-size: 11px; color: var(--text-secondary);">
                Type: ${campaign.type || 'N/A'} |
                Status: ${campaign.status || 'draft'}
                ${campaign.owner_name ? ` | ${campaign.owner_emoji} ${campaign.owner_name}` : ''}
              </span>
            </div>
          `).join('');
        } else {
          campaignsList.innerHTML = '<div style="text-align: center; padding: 20px; color: var(--text-muted);">No campaigns yet</div>';
        }

        // Load social posts from database (content type = 'social')
        const socialResponse = await fetch('/api/data/social');
        const social = await socialResponse.json();
        const socialList = document.getElementById('social-list');

        if (social && social.length > 0) {
          socialList.innerHTML = social.slice(0, 5).map(post => `
            <div class="data-item">
              <strong>${post.title || 'Untitled Post'}</strong><br>
              <span style="font-size: 11px; color: var(--text-secondary);">
                Status: ${post.status || 'draft'}
                ${post.published_at ? ` | Published: ${new Date(post.published_at).toLocaleDateString()}` : ''}
                ${post.author_name ? ` | by ${post.author_emoji} ${post.author_name}` : ''}
              </span>
            </div>
          `).join('');
        } else {
          socialList.innerHTML = '<div style="text-align: center; padding: 20px; color: var(--text-muted);">No social posts yet</div>';
        }
      } catch (error) {
        console.error('Error loading marketing data:', error);
        // Show error state instead of mockup data
        document.getElementById('leads-list').innerHTML = '<div style="text-align: center; padding: 20px; color: var(--text-muted);">Error loading leads</div>';
        document.getElementById('campaigns-list').innerHTML = '<div style="text-align: center; padding: 20px; color: var(--text-muted);">Error loading campaigns</div>';
        document.getElementById('social-list').innerHTML = '<div style="text-align: center; padding: 20px; color: var(--text-muted);">Error loading social posts</div>';
      }
    }

    // Start marketing job
    async function startMarketingJob() {
      const model = document.getElementById('model-select').value;
      const priorityFile = document.getElementById('priority-file').value;
      const branchName = document.getElementById('branch-name').value;
      const campaignDesc = document.getElementById('campaign-desc').value;

      if (!priorityFile && !campaignDesc) {
        alert('‚ùå Please enter either a campaign file or description');
        return;
      }

      if (!branchName) {
        alert('‚ùå Please enter a branch name');
        return;
      }

      try {
        const response = await fetch('/api/jobs/start', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            team: 'marketing',
            model,
            priorityFile: priorityFile || 'inline-campaign',
            branchName,
            description: campaignDesc
          })
        });

        if (!response.ok) {
          const error = await response.json();
          alert('‚ùå Error: ' + error.error);
          return;
        }

        const job = await response.json();
        alert(`‚úÖ Marketing campaign started!\n\nJob ID: ${job.jobId}\nModel: ${job.model}\nPID: ${job.pid}\n\nJarvis and team are on it! ü¶∏`);

        // Clear form
        document.getElementById('priority-file').value = '';
        document.getElementById('branch-name').value = '';
        document.getElementById('campaign-desc').value = '';
      } catch (error) {
        alert('‚ùå Error: ' + error.message);
      }
    }

    // View agent details (comprehensive modal with DB data)
    async function viewAgentDetails(agentName) {
      try {
        // Get all agents to find the ID
        const allAgentsResponse = await fetch('/api/agents');
        const allAgents = await allAgentsResponse.json();
        const agent = allAgents.find(a => a.name === agentName);

        if (!agent) {
          alert(`Agent ${agentName} not found in database`);
          return;
        }

        // Get full evaluation
        const evalResponse = await fetch(`/api/agents/${agent.id}/evaluation`);
        const evaluation = await evalResponse.json();

        if (!evaluation || !evaluation.agent) {
          alert(`Could not load evaluation for ${agentName}`);
          return;
        }

        const { agent: agentData, performance, taskStats, recentTasks, gamification, lessonsLearned, evaluation: rlEval } = evaluation;

        // Build task stats summary
        const taskStatsHtml = taskStats && taskStats.length > 0
          ? taskStats.map(t => `<div style="display: inline-block; margin-right: 20px;"><strong>${t.status}:</strong> ${t.count}</div>`).join('')
          : '<div>No tasks yet</div>';

        // Build recent tasks list
        const recentTasksHtml = recentTasks && recentTasks.length > 0
          ? recentTasks.slice(0, 10).map(task => {
              const statusIcon = task.status === 'completed' ? '‚úÖ' : task.status === 'failed' ? '‚ùå' : task.status === 'in_progress' ? 'üîÑ' : '‚è∏Ô∏è';
              const duration = task.duration_seconds ? `${Math.round(task.duration_seconds / 60)}m` : '-';
              return `
                <div style="padding: 8px; background: var(--glass-light); border-radius: 8px; margin-bottom: 8px;">
                  ${statusIcon} <strong>${task.description?.substring(0, 60) || 'Task'}${task.description?.length > 60 ? '...' : ''}</strong>
                  <div style="font-size: 11px; color: var(--text-secondary); margin-top: 4px;">
                    Duration: ${duration} | LLM: ${task.llm_used || 'N/A'} | ${new Date(task.started_at).toLocaleDateString()}
                  </div>
                </div>
              `;
            }).join('')
          : '<div style="color: var(--text-muted); font-style: italic;">No tasks yet</div>';

        // Build gamification section
        const gamificationHtml = gamification
          ? `
            <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 15px; margin-top: 10px;">
              <div style="text-align: center; padding: 15px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border-radius: 12px; color: white;">
                <div style="font-size: 32px;">${gamification.level_emoji}</div>
                <div style="font-size: 20px; font-weight: 800;">Level ${gamification.level}</div>
                <div style="font-size: 12px; opacity: 0.9;">${gamification.title}</div>
              </div>
              <div style="text-align: center; padding: 15px; background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); border-radius: 12px; color: white;">
                <div style="font-size: 28px; font-weight: 800;">${gamification.total_xp}</div>
                <div style="font-size: 12px; opacity: 0.9;">Total XP</div>
                <div style="font-size: 10px; opacity: 0.7;">${gamification.xp_to_next_level} to next</div>
              </div>
              <div style="text-align: center; padding: 15px; background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%); border-radius: 12px; color: white;">
                <div style="font-size: 28px; font-weight: 800;">${gamification.achievements_unlocked}</div>
                <div style="font-size: 12px; opacity: 0.9;">Achievements</div>
              </div>
              <div style="text-align: center; padding: 15px; background: linear-gradient(135deg, #fa709a 0%, #fee140 100%); border-radius: 12px; color: white;">
                <div style="font-size: 28px;">üî•</div>
                <div style="font-size: 20px; font-weight: 800;">${gamification.current_streak}</div>
                <div style="font-size: 12px; opacity: 0.9;">Day Streak</div>
              </div>
            </div>
          `
          : '<div style="color: var(--text-muted); font-style: italic;">Gamification data not available</div>';

        // Build lessons learned section
        const lessonsHtml = lessonsLearned && lessonsLearned.length > 0
          ? lessonsLearned.slice(0, 5).map(lesson => `
              <div style="padding: 10px; background: var(--glass-light); border-left: 4px solid #667eea; border-radius: 8px; margin-bottom: 10px;">
                <div style="font-weight: 700; color: var(--text-primary);">${lesson.title}</div>
                <div style="font-size: 12px; color: var(--text-secondary); margin-top: 4px;">${lesson.description}</div>
                <div style="font-size: 11px; color: var(--text-muted); margin-top: 4px;">
                  Category: ${lesson.category || 'General'} | Encountered ${lesson.times_encountered}x
                  ${lesson.is_automated ? ' | ‚úÖ Automated' : ''}
                </div>
              </div>
            `).join('')
          : '<div style="color: var(--text-muted); font-style: italic;">No lessons learned yet</div>';

        // Create modal HTML
        const modalHtml = `
          <div style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.7); z-index: 9999; display: flex; align-items: center; justify-content: center;" onclick="this.remove()">
            <div style="background: var(--bg-primary); border-radius: 20px; max-width: 900px; max-height: 90vh; overflow-y: auto; padding: 30px; box-shadow: 0 20px 60px rgba(0,0,0,0.3);" onclick="event.stopPropagation()">

              <!-- Header -->
              <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 25px;">
                <div style="display: flex; align-items: center; gap: 15px;">
                  <div style="font-size: 48px;">${agentData.emoji || 'ü§ñ'}</div>
                  <div>
                    <h2 style="margin: 0; color: var(--text-primary); font-size: 28px;">${agentData.name}</h2>
                    <div style="color: var(--text-secondary); font-size: 14px;">${agentData.team_name || agentData.team_id} | ${agentData.role}</div>
                  </div>
                </div>
                <button onclick="this.closest('[style*=\\'fixed\\']').remove()" style="background: none; border: none; font-size: 32px; cursor: pointer; color: var(--text-muted);">&times;</button>
              </div>

              <!-- Agent Soul (Description/Role) -->
              <div style="background: var(--glass-light); border-radius: 12px; padding: 20px; margin-bottom: 20px;">
                <h3 style="margin: 0 0 10px 0; color: var(--text-primary); font-size: 18px;">üéØ Agent Soul</h3>
                <div style="color: var(--text-secondary);">${agentData.role}</div>
                <div style="margin-top: 10px; font-size: 13px; color: var(--text-muted);">
                  LLM Preference: <strong>${agentData.llm_preference}</strong> |
                  Status: ${agentData.is_active ? '<span style="color: #48bb78;">‚úÖ Active</span>' : '<span style="color: #f56565;">‚ùå Inactive</span>'}
                </div>
              </div>

              <!-- Gamification -->
              <div style="background: var(--glass-light); border-radius: 12px; padding: 20px; margin-bottom: 20px;">
                <h3 style="margin: 0 0 10px 0; color: var(--text-primary); font-size: 18px;">üéÆ Gamification</h3>
                ${gamificationHtml}
              </div>

              <!-- Performance & RL Evaluation -->
              <div style="background: var(--glass-light); border-radius: 12px; padding: 20px; margin-bottom: 20px;">
                <h3 style="margin: 0 0 10px 0; color: var(--text-primary); font-size: 18px;">üìä Performance & RL Evaluation</h3>
                <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px; margin-top: 15px;">
                  <div style="text-align: center;">
                    <div style="font-size: 28px; font-weight: 800; color: #667eea;">${rlEval.successRate}</div>
                    <div style="font-size: 12px; color: var(--text-secondary);">Success Rate</div>
                  </div>
                  <div style="text-align: center;">
                    <div style="font-size: 28px; font-weight: 800; color: #667eea;">${performance?.total_tasks_completed || 0}</div>
                    <div style="font-size: 12px; color: var(--text-secondary);">Completed</div>
                  </div>
                  <div style="text-align: center;">
                    <div style="font-size: 28px; font-weight: 800; color: #f56565;">${performance?.total_tasks_failed || 0}</div>
                    <div style="font-size: 12px; color: var(--text-secondary);">Failed</div>
                  </div>
                </div>
                <div style="margin-top: 15px; padding: 15px; background: var(--glass-light); border-left: 4px solid #667eea; border-radius: 8px;">
                  <div style="font-weight: 700; color: var(--text-primary);">Recommendation: ${rlEval.recommendation.toUpperCase()}</div>
                  <div style="font-size: 13px; color: var(--text-secondary); margin-top: 5px;">${rlEval.reason}</div>
                </div>
              </div>

              <!-- Task Stats -->
              <div style="background: var(--glass-light); border-radius: 12px; padding: 20px; margin-bottom: 20px;">
                <h3 style="margin: 0 0 10px 0; color: var(--text-primary); font-size: 18px;">üìã Task Statistics</h3>
                <div style="margin-top: 10px;">
                  ${taskStatsHtml}
                </div>
              </div>

              <!-- Recent Tasks -->
              <div style="background: var(--glass-light); border-radius: 12px; padding: 20px; margin-bottom: 20px;">
                <h3 style="margin: 0 0 15px 0; color: var(--text-primary); font-size: 18px;">üìù Recent Tasks</h3>
                ${recentTasksHtml}
              </div>

              <!-- Lessons Learned -->
              <div style="background: var(--glass-light); border-radius: 12px; padding: 20px;">
                <h3 style="margin: 0 0 15px 0; color: var(--text-primary); font-size: 18px;">üí° Lessons Learned</h3>
                ${lessonsHtml}
              </div>

            </div>
          </div>
        `;

        // Insert modal into page
        document.body.insertAdjacentHTML('beforeend', modalHtml);

      } catch (error) {
        console.error('Error loading agent details:', error);
        alert(`‚ùå Error: ${error.message}`);
      }
    }

    // Refresh functions
    function refreshAgents() {
      loadAgents();
    }

    function refreshData() {
      loadMarketingData();
    }

    // Initialize on load
    init();
  </script>
</body>
</html>
